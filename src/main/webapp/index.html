<!DOCTYPE html>
<html>
    <head>
        <title>Start Page</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    </head>
    <body>
        <div id="test"></div>
        <p>
            <button class="btn btn-lg btn-default" onclick="readBatteryLevel()">Read Bluetooth device's<br>battery level</button>
        </p>

        <p id="target"></p>

        <p><small>Based on code snippets from <a href="https://developers.google.com/web/updates/2015/07/interact-with-ble-devices-on-the-web" target="_blank">Google Developers</a>.</small></p>
    </body>
    <script>
        function readBatteryLevel() {
            var $target = document.getElementById('target');

            if (!('bluetooth' in navigator)) {
                $target.innerText = 'Bluetooth API not supported.';
                return;
            }

            navigator.bluetooth.requestDevice({
                acceptAllDevices: true,
                optionalServices: ['battery_service']
            })
                    .then(function (device) {
                        $target.innerText = device;
//                        return device.gatt.connect();
                    })
                    .then(function (server) {
//                        return server.getPrimaryService('battery_service');
                    })
                    .then(function (service) {
//                        return service.getCharacteristic('battery_level');
                    })
                    .then(function (characteristic) {
//                        return characteristic.readValue();
                    })
                    .then(function (value) {
//                        $target.innerHTML = 'Battery percentage is <b>' + value.getUint8(0) + '</b>.';
                    })
                    .catch(function (error) {
                        $target.innerText = error;
                    });
        }

        let options = {};
        options.acceptAllDevices = true;

        navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: ['battery_service']
        })
                .then(device => {
                    // Human-readable name of the device.
                    console.log(device.name);
                    $('#test').append('<p>' + device.name + '</p>');
                    // Attempts to connect to remote GATT Server.
                    return device.gatt.connect();
                })
                .then(server => { /* ... */
                })
                .catch(error => {
                    $('#test').append('<p>' + error + '</p>');
                    console.log(error);
                });
    </script>
</html>
